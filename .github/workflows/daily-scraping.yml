name: Daily Volleyball Scraping

on:
  schedule:
    # Codziennie o 09:00 UTC = 11:00 w Polsce (UTC+2)
    - cron: '0 9 * * *'
  
  # MoÅ¼liwoÅ›Ä‡ rÄ™cznego uruchomienia (zakÅ‚adka Actions na GitHub)
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    timeout-minutes: 30  # Max 30 minut na caÅ‚e zadanie
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'  # Cache zaleÅ¼noÅ›ci dla szybszego dziaÅ‚ania
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
        
        # SprawdÅº wersje
        chromium-browser --version
        chromedriver --version
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ Run Volleyball Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports volleyball \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        # Zmienne Å›rodowiskowe dla Selenium
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload outputs (jeÅ›li sÄ…)
      if: always()  # Uploaduj nawet jeÅ›li scraping siÄ™ nie powiÃ³dÅ‚
      uses: actions/upload-artifact@v3
      with:
        name: scraping-results-${{ github.run_number }}
        path: outputs/*.csv
        if-no-files-found: ignore
        retention-days: 30  # Przechowuj przez 30 dni
    
    - name: âœ… Job completed
      if: success()
      run: |
        echo "âœ… Scraping zakoÅ„czony pomyÅ›lnie!"
        echo "ğŸ“§ Email wysÅ‚any do jakub.majka.zg@gmail.com"

