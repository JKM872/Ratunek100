name: Midnight Auto Scraping (All Sports)

on:
  schedule:
    # Codziennie o 23:00 UTC = 0:00 czasu warszawskiego (UTC+1)
    # W letnim czasie (UTC+2) bÄ™dzie to 1:00, ale lepiej zachowaÄ‡ staÅ‚Ä… godzinÄ™
    - cron: '0 23 * * *'
  
  # MoÅ¼liwoÅ›Ä‡ rÄ™cznego uruchomienia (zakÅ‚adka Actions na GitHub)
  workflow_dispatch:

jobs:
  # âš½ FOOTBALL
  football:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: âš½ Run Football Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping Football dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports football \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload Football outputs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: football-results-${{ github.run_number }}
        path: outputs/*football*.csv
        if-no-files-found: ignore
        retention-days: 30

  # ğŸ€ BASKETBALL
  basketball:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ€ Run Basketball Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping Basketball dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports basketball \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload Basketball outputs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: basketball-results-${{ github.run_number }}
        path: outputs/*basketball*.csv
        if-no-files-found: ignore
        retention-days: 30

  # ğŸ¤¾ HANDBALL
  handball:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ¤¾ Run Handball Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping Handball dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports handball \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload Handball outputs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: handball-results-${{ github.run_number }}
        path: outputs/*handball*.csv
        if-no-files-found: ignore
        retention-days: 30

  # ğŸ VOLLEYBALL
  volleyball:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ Run Volleyball Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping Volleyball dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports volleyball \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload Volleyball outputs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: volleyball-results-${{ github.run_number }}
        path: outputs/*volleyball*.csv
        if-no-files-found: ignore
        retention-days: 30

  # ğŸ’ HOCKEY
  hockey:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ’ Run Hockey Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping Hockey dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports hockey \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload Hockey outputs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: hockey-results-${{ github.run_number }}
        path: outputs/*hockey*.csv
        if-no-files-found: ignore
        retention-days: 30

  # ğŸ¾ TENNIS
  tennis:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸŒ Install Chrome & ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
    
    - name: ğŸ“¦ Install Python dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ¾ Run Tennis Scraping
      run: |
        TODAY=$(date +%Y-%m-%d)
        echo "ğŸ—“ï¸ Scraping Tennis dla daty: $TODAY"
        
        python scrape_and_notify.py \
          --date $TODAY \
          --sports tennis \
          --to jakub.majka.zg@gmail.com \
          --from-email jakub.majka.zg@gmail.com \
          --password "${{ secrets.EMAIL_PASSWORD }}" \
          --headless \
          --sort-by time
      
      env:
        DISPLAY: ':99'
    
    - name: ğŸ“Š Upload Tennis outputs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: tennis-results-${{ github.run_number }}
        path: outputs/*tennis*.csv
        if-no-files-found: ignore
        retention-days: 30

